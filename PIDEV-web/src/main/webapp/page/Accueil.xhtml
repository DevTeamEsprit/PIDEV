<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:jsf="http://xmlns.jcp.org/jsf" xmlns:p="http://primefaces.org/ui"
	xmlns:a="http://xmlns.jcp.org/jsf/passthrough" lang="fr"
	xmlns:c="http://java.sun.com/jstl/core"
	template="/template/templateNew.xhtml">
	<ui:define name="pageTitle">Accueil</ui:define>
	<ui:define name="content">
		<div class="row">
			<br></br>
			<div class="col-md-9">

				<!-- Box ajout publicaiton -->

				<h:form>
					<div class="card card-primary">
						<div class="card-header">
							<div class="user-block">
								<img class="img-circle"
									src="data:image/png;base64,#{loginbean.user.image}"
									alt="User Image" /> <span class="username"><a href="#">cr√©er
										une publication</a></span>
							</div>
						</div>

						<div class="card-body">
							<div class="form-group">
								<p:inputTextarea
									value="#{publicationBean.publication.description}"
									class="form-control" rows="3" placeholder="Exprimez-vous" />
							</div>
						</div>

						<div class="card-footer">
							<h:commandButton class="btn btn-primary float-right"
								value="Publier" action="#{publicationBean.addPub()}" />
						</div>
					</div>
				</h:form>

				<h:form id="publicationsForm">
					<ui:repeat value="#{publicationBean.list}" var="entry">
						<div class="card card-widget">
							<div class="card-header">
								<div class="user-block">
									<img class="img-circle"
										src="data:image/png;base64,#{entry.publication.user.image}"
										alt="User Image" /> <span class="username"> <a
										href="#">#{entry.publication.user.nom}
											#{entry.publication.user.prenom}</a>
									</span> <span class="description"> Shared publicly - <h:outputText
											id="date" converterMessage="#{i18n['converter-message']}"
											value="#{entry.publication.dateCreation}">
											<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
										</h:outputText>
									</span>
								</div>
								<div class="card-tools">
									<h:commandLink 
										rendered="#{entry.publication.user.id == loginbean.user.id}"
										class="btn btn-tool btn-tool-edit"
										title="Modifier">
										<i class="fas fa-edit"></i>
									</h:commandLink>
									<h:commandLink 
										rendered="#{entry.publication.user.id == loginbean.user.id}"
										class="btn btn-tool btn-tool-delete"
										title="Supprimer">
										<i class="fas fa-trash"></i>
									</h:commandLink>
									
								</div>
							</div>
							<!-- /.card-header -->
							<div class="card-body">
								<!-- post text -->
								<p>#{entry.publication.description}</p>
								<button type="button" class="btn btn-default btn-sm">
									<i class="far fa-thumbs-up"></i> Like
								</button>
								<span class="float-right text-muted">45 likes -
									#{entry.publication.lstComm.size()} comments</span>
							</div>
							<!-- /.card-body -->
							<div class="card-footer card-comments">
								<ui:repeat value="#{entry.publication.lstComm}" var="com">
									<div class="card-comment">
										<!-- User image -->
										<img class="img-circle img-sm"
											src="data:image/png;base64,#{com.user.image}"
											alt="User Image" />
										<div class="comment-text">
											<span class="username"> #{com.user.nom}
												#{com.user.prenom} <span class="text-muted float-right">
													<h:outputText id="date"
														converterMessage="#{i18n['converter-message']}"
														value="#{com.dateCreation}">
														<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
													</h:outputText>
											</span>
											</span> #{com.description}
										</div>
										<!-- /.comment-text -->
									</div>
									<!-- /.card-comment -->
								</ui:repeat>
							</div>
							<!-- /.card-footer -->
							<div class="card-footer">
								<img class="img-fluid img-circle img-sm"
									src="data:image/png;base64,#{loginbean.user.image}"
									alt="Alt Text" />
								<!-- .img-push is used to add margin to elements next to floating images -->
								<div class="img-push">
									<div class="input-group">
										<h:inputText value="#{entry.commentaire.description}"
											type="text" class="form-control"
											placeholder="Enter a comment"
											onkeydown="if (event.keyCode === 13) { return false; }" />
										<span class="input-group-append"> <p:commandButton
												value="Commenter"
												action="#{publicationBean.addComm(entry.commentaire)}"
												update="@form" class="btn btn-primary" />
										</span>
									</div>
								</div>
							</div>
							<!-- /.card-footer -->
						</div>
					</ui:repeat>
				</h:form>
			</div>
			<!-- /.card -->
		</div>
	</ui:define>
</ui:composition>